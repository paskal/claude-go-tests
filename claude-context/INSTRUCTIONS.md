Please write tests for this Go code following the patterns and style shown in the examples in this directory.

Focus on:
    - Table-driven tests
    - Edge cases
    - Error scenarios
    - Mocking external dependencies using locally constructed mocks where it makes sense and https://github.com/matryer/moq in more complex cases
    - Use github.com/stretchr/testify/assert and github.com/stretchr/testify/require packages
    - Single test file for single input file should be used, not more.
